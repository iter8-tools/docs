---
template: main.html
---

# Benchmark and Validate gRPC services

The `load-test-grpc` experiment generates call requests for gRPC services, collects latency and error-related metrics, and validates service-level objectives (SLOs).

<p align='center'>
  <img alt-text="load-test-http" src="../images/grpc-overview.png" width="90%" />
</p>

***

--8<-- "docs/tutorials/load-test-http/usecases.md"

***

???+ warning "Before you begin"
    Run the gRPC sample service from a separate terminal.
    ```shell
    docker run -p 50051:50051 docker.io/grpc/java-example-hostname:latest
    ```
    You can also use [Podman](https://podman.io) or other alternatives to Docker in the above command.
***

## Basic example
Benchmark a gRPC service by specifying its `host`, its fully-qualified `call` (method) name, and the URL of Protocol Buffer file (`protoURL`) that defines the service.

```shell title="Launch load-test-grpc experiment"
iter8 launch -c load-test-grpc \
--set host="127.0.0.1:50051" \
--set call="helloworld.Greeter.SayHello" \
--set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto"
```

***

## Metrics and SLOs
The following metrics are collected by default by this experiment:

- `grpc/request-count`: total number of requests sent
- `grpc/error-count`: number of error responses
- `grpc/error-rate`: fraction of error responses

The following latency metrics are also supported.

- `grpc/latency/mean`: Mean latency
- `grpc/latency/stddev`: Standard deviation of latency
- `grpc/latency/min`: Min latency
- `grpc/latency/max`: Max latency
- `grpc/latency/pX`: X-th percentile latency, for any X in the range 0.0 to 100.0

Latency metrics have `msec` units. Any latency metric that is specified as part of SLOs is also collected.

***

For example, invoke `iter8 launch` as follows. The `--noDownload` flag reuses the Iter8 experiment `charts` folder downloaded during the previous `iter8 launch` invocation.

```shell
iter8 launch -c load-test-grpc --noDownload \
--set host="127.0.0.1:50051" \
--set call="helloworld.Greeter.SayHello" \
--set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
--set SLOs.grpc/error-rate=0 \
--set SLOs.grpc/latency/mean=50 \
--set SLOs.grpc/latency/p90=100 \
--set SLOs.grpc/latency/p'97\.5'=200
```

In the above setting, the following SLOs are validated.

- error rate is 0
- mean latency is under 50 msec
- 90th percentile latency is under 100 msec
- 97.5th percentile latency is under 200 msec

***

## View experiment report

--8<-- "docs/tutorials/load-test-grpc/expreport.md"

***

## Assertions

--8<-- "docs/tutorials/load-test-http/assert.md"

***

## Load profile
Control the characteristics of the generated load generated by setting the number of requests (`total`), the number of requests per second (`rps`), number of connections to use (`connections`), and the number of concurrent request workers to use which will be distributed across the connections (`concurrency`).

```shell title="Sample load profile"
iter8 launch -c load-test-grpc --noDownload \
--set host="127.0.0.1:50051" \
--set call="helloworld.Greeter.SayHello" \
--set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
--set total=500 \
--set rps=25 \
--set concurrency=50 \
--set connections=10
```

## Call data
gRPC calls may include data serialized as [Protocol Buffer messages](https://grpc.io/docs/what-is-grpc/introduction/#working-with-protocol-buffers).

=== "Data"
    Specify call data as values.

    ```shell title="Flat"
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set data.name="frodo"
    ```

    ```shell title="Nested"
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set data.name="frodo" \
    --set data.realm.planet="earth" \
    --set data.realm.location="middle" 
    ```

=== "Data file"
    Use JSON data from a local file.

    ```shell
    cat << EOF > data.json
    {
      "name": "Iter8 user"
    }
    EOF
    ```

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set data-file="data.json"
    ```

=== "Data URL"
    Supply a URL that hosts JSON data. Iter8 will download the data from this URL and use it in the requests.
    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set dataURL="https://gist.githubusercontent.com/sriumcp/3f3178f4b698af6696c925832e51b0ba/raw/d02aa698d34aa2067f7a2f6afb4ceb616b0db822/name.json"
    ```

=== "Binary data file"
    Use binary data from a local file serialized as a single binary message or multiple count-prefixed messages.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set binary-file="/the/path/to/data.bin" # "./data.bin" also works
    ```

=== "Binary data URL"
    Supply a URL that hosts binary data serialized as a single binary message or multiple count-prefixed messages. Iter8 will download the data from this URL and use it in the requests.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set binaryDataURL="https://location.of/data.bin"
    ```

***

For client streaming or bi-directional calls, this experiment accepts an array of messages, each element representing a single message within the stream call. If a single object is given for data, then it is automatically converted to an array with single element.

```shell
iter8 launch -c load-test-grpc --noDownload \
--set host="127.0.0.1:50051" \
--set call="helloworld.Greeter.SayHello" \
--set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
--set data[0].name="Joe" \
--set data[1].name="Kate" \
--set data[2].name="Sara"
```
    
In case of client streaming, this experiment sends all the data in the input array, and then closes and receives.


## Call metadata
gRPC calls may include [metadata](https://grpc.io/docs/what-is-grpc/core-concepts/#metadata) which is information about a particular call.

=== "Metadata"
    Supply metadata as values.
    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set metadata.darth="vader" \
    --set metadata.lord="sauron" \
    --set metadata.volde="mort"
    ```

=== "Metadata file"
    Use JSON metadata from a local file.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set metadata-file="/the/path/to/metadata.json" # "./metadata.json" also works
    ```

=== "Metadata URL"
    Supply a URL that hosts JSON metadata. Iter8 will download the metadata from this URL and use it in the requests.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto" \
    --set metadataURL="https://location.of/metadata.json"
    ```


## Proto and reflection
The gRPC server method signatures and message formats are defined in a `.proto` source file, which may also be compiled to a `.protoset` file.

=== "Proto file"
    Use a local `.proto` source file.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set proto="/path/to/helloworld.proto" # "./helloworld.proto" also works
    ```

=== "Proto URL"
    Use a URL that hosts a `.proto` source file. Iter8 will download the Protocol Buffer file and use it in the experiment.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.proto"
    ```

=== "Protoset file"
    Supply the name of a `.protoset` file that is compiled from `.proto` source files.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protoset="./myservice.protoset"
    ```

=== "Protoset URL"
    Supply a URL that hosts a `.protoset` file.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set protosetURL="https://raw.githubusercontent.com/grpc/grpc-go/master/examples/helloworld/helloworld/helloworld.protoset"
    ```

=== "Reflection"
    In the absence of `.proto` and `.protoset` information, the experiment will attempt to use [server reflection](https://github.com/grpc/grpc/blob/master/doc/server-reflection.md). You can supply reflect metadata.

    ```shell
    iter8 launch -c load-test-grpc --noDownload \
    --set host="127.0.0.1:50051" \
    --set call="helloworld.Greeter.SayHello" \
    --set reflect-metadata.clientId="5hL64dd0" \
    --set reflect-metadata.clientMood="delightful"
    ```

***

To learn more about all the parameters of the `load-test-grpc` chart and their default values, please refer to the [chart's `values.yaml` file](../../user-guide/topics/values.md).