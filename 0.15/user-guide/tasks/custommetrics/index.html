<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Iter8 is the Kubernetes release optimizer built for DevOps, MLOps, SRE and data science teams. Iter8 makes it easy to ensure that Kubernetes apps and ML models perform well and maximize business value."><meta name=author content="Srinivasan Parthasarathy"><link href=https://iter8.tools/latest/0.15/user-guide/tasks/custommetrics/ rel=canonical><link rel=icon href=../../../images/favicon.png><meta name=generator content="mkdocs-1.5.2, mkdocs-material-8.5.10"><title>custommetrics - Iter8</title><link rel=stylesheet href=../../../assets/stylesheets/main.975780f9.min.css><link rel=stylesheet href=../../../assets/stylesheets/palette.2505c338.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-152813895-1","auto"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");ga("send","event","feedback","click",t,e),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){ga("send","pageview",e.pathname)})});var e=document.createElement("script");e.async=!0,e.src="https://www.google-analytics.com/analytics.js",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><!-- Open graph meta tags --><meta property=og:type content=website><meta property=og:site_name content=Iter8><meta property=og:title content="Kubernetes Release Optimizer"><meta property=og:description content="Iter8 is the Kubernetes release optimizer built for DevOps, MLOps, SRE and data science teams. Iter8 makes it easy to ensure that Kubernetes apps and ML models perform well and maximize business value."><meta property=og:url content=https://iter8.tools><meta property=og:image content=https://iter8-tools.github.io/docs/0.9/images/iter8-intro-dark.png><!-- Twitter meta tags --><meta name=twitter:card content=summary_large_image><meta name=twitter:domain value=iter8.tools><meta name=twitter:url content=https://iter8.tools><meta name=twitter:creator content="Srinivasan Parthasarathy"><meta name=twitter:title content="Kubernetes Release Optimizer"><meta name=twitter:description content="Iter8 is the Kubernetes release optimizer built for DevOps, MLOps, SRE and data science teams. Iter8 makes it easy to ensure that Kubernetes apps and ML models perform well and maximize business value."><meta name=twitter:image content=https://iter8-tools.github.io/docs/0.9/images/iter8-intro-dark.png><!-- Extra stylesheets --><link rel=stylesheet href=../../../stylesheets/main.css><!-- Place this tag in your head or just before your close body tag. --><script async defer src=https://buttons.github.io/buttons.js></script></head> <body dir=ltr data-md-color-scheme=primary data-md-color-primary=black data-md-color-accent=deep-orange> <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#custommetrics class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../.. title=Iter8 class="md-header__button md-logo" aria-label=Iter8 data-md-component=logo> <img src=../../../images/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Iter8 </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> custommetrics </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media data-md-color-scheme=primary data-md-color-primary=black data-md-color-accent=deep-orange aria-hidden=true type=radio name=__palette id=__palette_1> </form> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/iter8-tools/iter8 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> iter8-tools/iter8 </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../../getting-started/your-first-experiment/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../../tutorials/load-test-http-multiple/ class=md-tabs__link> Tutorials </a> </li> <li class=md-tabs__item> <a href=../assess/ class="md-tabs__link md-tabs__link--active"> User guide </a> </li> <li class=md-tabs__item> <a href=../../../contributing/ class=md-tabs__link> Contributing </a> </li> <li class=md-tabs__item> <a href=../../../roadmap/ class=md-tabs__link> Roadmap </a> </li> <li class=md-tabs__item> <a href=../../../community/community/ class=md-tabs__link> Community </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../.. title=Iter8 class="md-nav__button md-logo" aria-label=Iter8 data-md-component=logo> <img src=../../../images/logo.svg alt=logo> </a> Iter8 </label> <div class=md-nav__source> <a href=https://github.com/iter8-tools/iter8 title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> iter8-tools/iter8 </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../.. class=md-nav__link> Home </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_2 type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2> Getting Started <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Getting Started" data-md-level=1> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../getting-started/your-first-experiment/ class=md-nav__link> Your first experiment </a> </li> <li class=md-nav__item> <a href=../../../getting-started/concepts/ class=md-nav__link> Concepts </a> </li> <li class=md-nav__item> <a href=../../../getting-started/install/ class=md-nav__link> Install Iter8 </a> </li> <li class=md-nav__item> <a href=../../../getting-started/help/ class=md-nav__link> Get help </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3 type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3> Tutorials <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tutorials data-md-level=1> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Tutorials </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/load-test-http-multiple/ class=md-nav__link> Load test multiple HTTP endpoints </a> </li> <li class=md-nav__item> <a href=../../../tutorials/load-test-grpc/ class=md-nav__link> Load test gRPC with SLOs </a> </li> <li class=md-nav__item> <a href=../../../tutorials/load-test-grpc-multiple/ class=md-nav__link> Load test multiple gRPC methods </a> </li> <li class=md-nav__item> <a href=../../../tutorials/chaos/slo-validation-chaos/ class=md-nav__link> Chaos injection with SLOs </a> </li> <li class=md-nav__item> <a href=../../../tutorials/abn/abn/ class=md-nav__link> A/B testing with Iter8 SDK </a> </li> <li class=md-nav__item> <a href=../../../tutorials/autox/autox/ class=md-nav__link> Automated experiments </a> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_7 type=checkbox id=__nav_3_7> <label class=md-nav__link for=__nav_3_7> Custom metrics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Custom metrics" data-md-level=2> <label class=md-nav__title for=__nav_3_7> <span class="md-nav__icon md-icon"></span> Custom metrics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/custom-metrics/one-version/ class=md-nav__link> One version </a> </li> <li class=md-nav__item> <a href=../../../tutorials/custom-metrics/two-or-more-versions/ class=md-nav__link> Two or more versions </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8 type=checkbox id=__nav_3_8> <label class=md-nav__link for=__nav_3_8> Integrations <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Integrations data-md-level=2> <label class=md-nav__title for=__nav_3_8> <span class="md-nav__icon md-icon"></span> Integrations </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/integrations/ghactions/ class=md-nav__link> GitHub Actions </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/istio/ class=md-nav__link> Istio </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/knative/ class=md-nav__link> Knative </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8_4 type=checkbox id=__nav_3_8_4> <label class=md-nav__link for=__nav_3_8_4> Kserve <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Kserve data-md-level=3> <label class=md-nav__title for=__nav_3_8_4> <span class="md-nav__icon md-icon"></span> Kserve </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8_4_1 type=checkbox id=__nav_3_8_4_1> <label class=md-nav__link for=__nav_3_8_4_1> Performance testing <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Performance testing" data-md-level=4> <label class=md-nav__title for=__nav_3_8_4_1> <span class="md-nav__icon md-icon"></span> Performance testing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve/http/ class=md-nav__link> HTTP </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve/grpc/ class=md-nav__link> gRPC </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve/canary-testing/ class=md-nav__link> Multiple Versions </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve/blue-green/ class=md-nav__link> Blue-Green testing </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve/canary/ class=md-nav__link> Canary testing </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve/continuous-validation/ class=md-nav__link> Continuous validation </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve/kserve/ class=md-nav__link> Other (Iter8 v0.7) </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_8_5 type=checkbox id=__nav_3_8_5> <label class=md-nav__link for=__nav_3_8_5> Kserve (modelmesh) <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Kserve (modelmesh)" data-md-level=3> <label class=md-nav__title for=__nav_3_8_5> <span class="md-nav__icon md-icon"></span> Kserve (modelmesh) </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve-mm/blue-green/ class=md-nav__link> Blue-Green </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/kserve-mm/canary/ class=md-nav__link> Canary </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/seldon/ class=md-nav__link> Seldon </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/slack/ class=md-nav__link> Slack </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/litmus/ class=md-nav__link> Litmus </a> </li> <li class=md-nav__item> <a href=../../../tutorials/integrations/linkerd/ class=md-nav__link> Linkerd </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_3_9 type=checkbox id=__nav_3_9> <label class=md-nav__link for=__nav_3_9> Earlier versions <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="Earlier versions" data-md-level=2> <label class=md-nav__title for=__nav_3_9> <span class="md-nav__icon md-icon"></span> Earlier versions </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=https://iter8-tools.github.io/iter8/0.8/ class=md-nav__link> Docs for Iter8 v0.8 </a> </li> <li class=md-nav__item> <a href=https://iter8-tools.github.io/iter8/0.7/ class=md-nav__link> Docs for Iter8 v0.7 </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4 type=checkbox id=__nav_4 checked> <label class=md-nav__link for=__nav_4> User guide <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label="User guide" data-md-level=1> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> User guide </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_1 type=checkbox id=__nav_4_1 checked> <label class=md-nav__link for=__nav_4_1> Tasks <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Tasks data-md-level=2> <label class=md-nav__title for=__nav_4_1> <span class="md-nav__icon md-icon"></span> Tasks </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../assess/ class=md-nav__link> assess </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> custommetrics <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> custommetrics </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#usage-example class=md-nav__link> Usage Example </a> </li> <li class=md-nav__item> <a href=#parameters class=md-nav__link> Parameters </a> </li> <li class=md-nav__item> <a href=#how-it-works class=md-nav__link> How it works </a> <nav class=md-nav aria-label="How it works"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#provider-spec class=md-nav__link> Provider spec </a> </li> <li class=md-nav__item> <a href=#provider-template class=md-nav__link> Provider template </a> </li> <li class=md-nav__item> <a href=#computing-variable-values class=md-nav__link> Computing variable values </a> </li> <li class=md-nav__item> <a href=#processing-response class=md-nav__link> Processing response </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#defining-and-using-providers class=md-nav__link> Defining and using providers </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../github/ class=md-nav__link> github </a> </li> <li class=md-nav__item> <a href=../grpc/ class=md-nav__link> grpc </a> </li> <li class=md-nav__item> <a href=../http/ class=md-nav__link> http </a> </li> <li class=md-nav__item> <a href=../slack/ class=md-nav__link> slack </a> </li> <li class=md-nav__item> <a href=../ready/ class=md-nav__link> ready </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_2 type=checkbox id=__nav_4_2> <label class=md-nav__link for=__nav_4_2> Topics <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Topics data-md-level=2> <label class=md-nav__title for=__nav_4_2> <span class="md-nav__icon md-icon"></span> Topics </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../topics/parameters/ class=md-nav__link> Experiment parameters </a> </li> <li class=md-nav__item> <a href=../../topics/metrics/ class=md-nav__link> Metrics </a> </li> <li class=md-nav__item> <a href=../../topics/group/ class=md-nav__link> Namespace and group </a> </li> <li class=md-nav__item> <a href=../../topics/autox/ class=md-nav__link> Automated experiments </a> </li> <li class=md-nav__item> <a href=../../topics/ab_testing/ class=md-nav__link> A/B/n testing </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_4_3 type=checkbox id=__nav_4_3> <label class=md-nav__link for=__nav_4_3> Commands <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Commands data-md-level=2> <label class=md-nav__title for=__nav_4_3> <span class="md-nav__icon md-icon"></span> Commands </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../commands/iter8/ class=md-nav__link> iter8 </a> </li> <li class=md-nav__item> <a href=../../commands/iter8_version/ class=md-nav__link> iter8 version </a> </li> <li class=md-nav__item> <a href=../../commands/iter8_k/ class=md-nav__link> iter8 k </a> </li> <li class=md-nav__item> <a href=../../commands/iter8_k_launch/ class=md-nav__link> iter8 k launch </a> </li> <li class=md-nav__item> <a href=../../commands/iter8_k_assert/ class=md-nav__link> iter8 k assert </a> </li> <li class=md-nav__item> <a href=../../commands/iter8_k_report/ class=md-nav__link> iter8 k report </a> </li> <li class=md-nav__item> <a href=../../commands/iter8_k_delete/ class=md-nav__link> iter8 k delete </a> </li> <li class=md-nav__item> <a href=../../commands/iter8_k_log/ class=md-nav__link> iter8 k log </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../../contributing/ class=md-nav__link> Contributing </a> </li> <li class=md-nav__item> <a href=../../../roadmap/ class=md-nav__link> Roadmap </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=__nav_7 type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7> Community <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Community data-md-level=1> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> Community </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../community/community/ class=md-nav__link> Community </a> </li> <li class=md-nav__item> <a href=../../../community/news/ class=md-nav__link> News </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#usage-example class=md-nav__link> Usage Example </a> </li> <li class=md-nav__item> <a href=#parameters class=md-nav__link> Parameters </a> </li> <li class=md-nav__item> <a href=#how-it-works class=md-nav__link> How it works </a> <nav class=md-nav aria-label="How it works"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#provider-spec class=md-nav__link> Provider spec </a> </li> <li class=md-nav__item> <a href=#provider-template class=md-nav__link> Provider template </a> </li> <li class=md-nav__item> <a href=#computing-variable-values class=md-nav__link> Computing variable values </a> </li> <li class=md-nav__item> <a href=#processing-response class=md-nav__link> Processing response </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#defining-and-using-providers class=md-nav__link> Defining and using providers </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=custommetrics>custommetrics<a class=headerlink href=#custommetrics title="Permanent link">&para;</a></h1> <p>Fetch metrics from databases (like Prometheus) and other REST APIs.</p> <h2 id=usage-example>Usage Example<a class=headerlink href=#usage-example title="Permanent link">&para;</a></h2> <p>In this example, the <code>custommetrics</code> task fetches metrics from the Prometheus database that is created by <a href=https://istio.io/latest/docs/ops/integrations/prometheus/ >Istio's Prometheus add-on</a>. </p> <div class=highlight><pre><span></span><code>iter8<span class=w> </span>k<span class=w> </span>launch<span class=w> </span><span class=se>\</span>
--set<span class=w> </span><span class=s2>&quot;tasks={custommetrics,assess}&quot;</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span>custommetrics.templates.istio-prom<span class=o>=</span><span class=s2>&quot;https://raw.githubusercontent.com/iter8-tools/iter8/v0.14.5/templates/custommetrics/istio-prom.tpl&quot;</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span>custommetrics.values.labels.destination_app<span class=o>=</span>httpbin<span class=w> </span><span class=se>\</span>
--set<span class=w> </span>custommetrics.values.labels.namespace<span class=o>=</span>default<span class=w> </span><span class=se>\</span>
--set<span class=w> </span>assess.SLOs.upper.istio-prom/error-rate<span class=o>=</span><span class=m>0</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span>assess.SLOs.upper.istio-prom/latency-mean<span class=o>=</span><span class=m>100</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span><span class=nv>runner</span><span class=o>=</span>cronjob<span class=w> </span><span class=se>\</span>
--set<span class=w> </span><span class=nv>cronjobSchedule</span><span class=o>=</span><span class=s2>&quot;*/1 * * * *&quot;</span>
</code></pre></div> <h2 id=parameters>Parameters<a class=headerlink href=#parameters title="Permanent link">&para;</a></h2> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>templates</td> <td>map[string]string</td> <td>A map where each key is the name of a <a href=../../topics/metrics/#provider>provider</a>, and the corresponding value is a URL containing the <a href=#provider-template>provider template</a>.</td> </tr> <tr> <td>values</td> <td>map[string]interface{}</td> <td>A map that contains the values for variables in <a href=#provider-template>provider templates</a>. When there are two or more app versions, this map contains values that are common to all versions.</td> </tr> <tr> <td>versionValues</td> <td>[]map[string]interface{}</td> <td>An array that contains version-specific values for variables in <a href=#provider-template>provider templates</a>. While fetching metrics for version <code>i</code>, the task merges <code>values</code> with <code>versionValues[i]</code> (latter takes precedence), and the merged map contains the values for variables in provider templates.</td> </tr> </tbody> </table> <h2 id=how-it-works>How it works<a class=headerlink href=#how-it-works title="Permanent link">&para;</a></h2> <p>The logic of this task is illustrated by the following flowchart.</p> <pre class=mermaid><code>graph TD
  A([Start]) --&gt; B([Get provider template]);
  B --&gt; C([Compute variable values]);
  C --&gt; D([Create provider spec by combining template with values]);
  D --&gt; E([Query database]);
  E --&gt; F([Process response]);
  F --&gt; G([Update metric value in experiment]);
  G --&gt; H{Done with all metrics?};
  H ----&gt;|No| E;
  H ----&gt;|Yes| I{Done with all versions?};
  I ----&gt;|No| C;
  I ----&gt;|Yes| J([End]);</code></pre> <p>We describe the concepts or <a href=#provider-spec>provider spec</a> and <a href=#provider-template>provider template</a> next.</p> <h3 id=provider-spec>Provider spec<a class=headerlink href=#provider-spec title="Permanent link">&para;</a></h3> <p>Iter8 needs the information following in order to fetch metrics from a database.</p> <ol> <li>The HTTP URL where the database can be queried.</li> <li>The HTTP headers and method (GET/POST) to be used while querying the database.</li> <li>For each metric to be fetched from the database:<ul> <li>The specific HTTP query to be used, in particular, the HTTP query parameters and body (if any).</li> <li>The logic for parsing the query response and retrieving the metric value.</li> </ul> </li> </ol> <p>The above information is encapsulated by <code>ProviderSpec</code>, a data structure which Iter8 associates with each provider, and <code>Metric</code>, a data structure which Iter8 associates with each metric provided by a provider.</p> <details class=tip open=open> <summary>Golang type definitions for ProviderSpec and Metric</summary> <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span>
<span class=normal>12</span>
<span class=normal>13</span>
<span class=normal>14</span>
<span class=normal>15</span>
<span class=normal>16</span>
<span class=normal>17</span>
<span class=normal>18</span>
<span class=normal>19</span>
<span class=normal>20</span>
<span class=normal>21</span>
<span class=normal>22</span>
<span class=normal>23</span>
<span class=normal>24</span>
<span class=normal>25</span>
<span class=normal>26</span>
<span class=normal>27</span>
<span class=normal>28</span>
<span class=normal>29</span>
<span class=normal>30</span>
<span class=normal>31</span>
<span class=normal>32</span>
<span class=normal>33</span>
<span class=normal>34</span>
<span class=normal>35</span></pre></div></td><td class=code><div><pre><span></span><code><span class=kd>type</span><span class=w> </span><span class=nx>ProviderSpec</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=c1>// URL is the database endpoint</span>
<span class=w>  </span><span class=nx>URL</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;url&quot; yaml:&quot;url&quot;`</span>
<span class=w>  </span><span class=c1>// Method is the HTTP method that needs to be used</span>
<span class=w>  </span><span class=nx>Method</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;method&quot; yaml:&quot;method&quot;`</span>
<span class=w>  </span><span class=c1>// Headers is the set of HTTP headers that need to be sent</span>
<span class=w>  </span><span class=nx>Headers</span><span class=w> </span><span class=kd>map</span><span class=p>[</span><span class=kt>string</span><span class=p>]</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;headers&quot; yaml:&quot;headers&quot;`</span>
<span class=w>  </span><span class=c1>// Metrics is the set of metrics that can be obtained</span>
<span class=w>  </span><span class=nx>Metrics</span><span class=w> </span><span class=p>[]</span><span class=nx>Metric</span><span class=w> </span><span class=s>`json:&quot;metrics&quot; yaml:&quot;metrics&quot;`</span>
<span class=p>}</span>

<span class=kd>type</span><span class=w> </span><span class=nx>Metric</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=c1>// Name is the name of the metric</span>
<span class=w>  </span><span class=nx>Name</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;name&quot; yaml:&quot;name&quot;`</span>
<span class=w>  </span><span class=c1>// Description is the description of the metric</span>
<span class=w>  </span><span class=nx>Description</span><span class=w> </span><span class=o>*</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;description,omitempty&quot; yaml:&quot;description,omitempty&quot;`</span>
<span class=w>  </span><span class=c1>// Type is the type of the metric, either gauge or counter</span>
<span class=w>  </span><span class=nx>Type</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;type&quot; yaml:&quot;type&quot;`</span>
<span class=w>  </span><span class=c1>// Units is the unit of the metric, which can be omitted for unitless metrics</span>
<span class=w>  </span><span class=nx>Units</span><span class=w> </span><span class=o>*</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;units,omitempty&quot; yaml:&quot;units,omitempty&quot;`</span>
<span class=w>  </span><span class=c1>// Params is the set of HTTP parameters that need to be sent</span>
<span class=w>  </span><span class=nx>Params</span><span class=w> </span><span class=o>*</span><span class=p>[]</span><span class=nx>HTTPParam</span><span class=w> </span><span class=s>`json:&quot;params,omitempty&quot; yaml:&quot;params,omitempty&quot;`</span>
<span class=w>  </span><span class=c1>// Body is the HTTP request body that needs to be sent</span>
<span class=w>  </span><span class=nx>Body</span><span class=w> </span><span class=o>*</span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;body,omitempty&quot; yaml:&quot;body,omitempty&quot;`</span>
<span class=w>  </span><span class=c1>// JqExpression is the jq expression that can extract the value from the HTTP</span>
<span class=w>  </span><span class=c1>// response</span>
<span class=w>  </span><span class=nx>JqExpression</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;jqExpression&quot; yaml:&quot;jqExpression&quot;`</span>
<span class=p>}</span>

<span class=kd>type</span><span class=w> </span><span class=nx>HTTPParam</span><span class=w> </span><span class=kd>struct</span><span class=w> </span><span class=p>{</span>
<span class=w>  </span><span class=c1>// Name is the name of the HTTP parameter</span>
<span class=w>  </span><span class=nx>Name</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;name&quot; yaml:&quot;name&quot;`</span>
<span class=w>  </span><span class=c1>// Value is the value of the HTTP parameter</span>
<span class=w>  </span><span class=nx>Value</span><span class=w> </span><span class=kt>string</span><span class=w> </span><span class=s>`json:&quot;value&quot; yaml:&quot;value&quot;`</span>
<span class=p>}</span>
</code></pre></div></td></tr></table></div> </details> <p>The <code>ProviderSpec</code> and <code>Metric</code> data structures together supply Iter8 with all the information needed to query databases, process the response to extract metric values, store the metric values in experiments, and display them in experiment reports with auxiliary information (such as description and units). Metric types are defined <a href=../../topics/metrics/#metric-types>here</a>.</p> <h3 id=provider-template>Provider template<a class=headerlink href=#provider-template title="Permanent link">&para;</a></h3> <p>Rather than supplying <a href=#provider-spec>provider specs</a> directly, Iter8 enables users to supply one or more <a href=https://pkg.go.dev/text/template>Golang templates</a> for provider specs. Iter8 combines the provider templates with <a href=#computing-variable-values>values</a>, in order to generate <a href=#provider-spec>provider specs</a> in YAML format, and uses them to query for the metrics.</p> <p>Example providers specs: * <a href=https://raw.githubusercontent.com/iter8-tools/iter8/v0.14.5/templates/custommetrics/istio-prom.tpl>istio-prom</a> for <a href=https://istio.io/latest/docs/ops/integrations/prometheus/ >Istio's Prometheus plugin</a></p> <p>In order to create <a href=#provider-template>provider templates</a> and use them in experiments, it is necessary to have a clear understanding of how variable values are computed, and how the response from the database is processed by Iter8. We describe these steps next.</p> <h3 id=computing-variable-values>Computing variable values<a class=headerlink href=#computing-variable-values title="Permanent link">&para;</a></h3> <p>Variable values are configured explicitly by the user during experiment launch. The sole exception to this rule is the <code>elapsedTimeSeconds</code> variable which is computed by Iter8. Please see the tabs below to learn more about how to configure values and how Iter8 computes <code>elapsedTimeSeconds</code>.</p> <div class="tabbed-set tabbed-alternate" data-tabs=1:3><input checked=checked id=__tabbed_1_1 name=__tabbed_1 type=radio><input id=__tabbed_1_2 name=__tabbed_1 type=radio><input id=__tabbed_1_3 name=__tabbed_1 type=radio><div class=tabbed-labels><label for=__tabbed_1_1>Configure values for one version</label><label for=__tabbed_1_2>Configure values for multiple versions</label><label for=__tabbed_1_3>How Iter8 computes <code>elapsedTimeSeconds</code></label></div> <div class=tabbed-content> <div class=tabbed-block> <p>When the experiment involves a single version of the app, template variable values are supplied directly as part of the <code>custommetrics.values</code> map. See <a href=#usage-example>usage example</a> for an illustration.</p> </div> <div class=tabbed-block> <p>When the experiment involves two or more versions of the app, values that are shared by all versions are supplied as part of the <code>custommetrics.values</code> map, and values that are specific to versions are supplied as part of the <code>custommetrics.versionValues</code> list. The length of this list is the number of versions, and <code>custommetrics.versionValues[i]</code> is the map that holds values specific to version <code>i</code>. Iter8 merges <code>custommetrics.values</code> with <code>custommetrics.versionValues[i]</code> (latter takes precedence), and uses the resulting map for version <code>i</code> when substituting template variables. Configuring values for two versions is illustrated in the following usage example.</p> <div class=highlight><pre><span></span><code>iter8<span class=w> </span>k<span class=w> </span>launch<span class=w> </span><span class=se>\</span>
--set<span class=w> </span><span class=s2>&quot;tasks={custommetrics,assess}&quot;</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span>custommetrics.templates.istio-prom<span class=o>=</span><span class=s2>&quot;https://raw.githubusercontent.com/iter8-tools/iter8/v0.14.5/templates/custommetrics/istio-prom.tpl&quot;</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span>custommetrics.values.labels.namespace<span class=o>=</span>default<span class=w> </span><span class=se>\</span>
--set<span class=w> </span>custommetrics.values.labels.destination_app<span class=o>=</span>httpbin<span class=w> </span><span class=se>\</span>
--set<span class=w> </span>custommetrics.values.labels.reporter<span class=o>=</span>destination<span class=w> </span><span class=se>\</span>
--set<span class=w> </span><span class=s1>&#39;custommetrics.versionValues[0].labels.destination_version=v1&#39;</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span><span class=s1>&#39;custommetrics.versionValues[1].labels.destination_version=v2&#39;</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span>assess.SLOs.upper.istio-prom/error-rate<span class=o>=</span><span class=m>0</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span>assess.SLOs.upper.istio-prom/latency-mean<span class=o>=</span><span class=m>100</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span><span class=nv>runner</span><span class=o>=</span>cronjob<span class=w> </span><span class=se>\</span>
--set<span class=w> </span><span class=nv>cronjobSchedule</span><span class=o>=</span><span class=s2>&quot;*/1 * * * *&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <p>A metric query often involves specifying the time window over which the metric need to be computed. In <a href=#provider-template>provider templates</a>, a special template variable named <code>elapsedTimeSeconds</code> holds the length of this time window. Its use within a template is illustrated in the following snippets.</p> <div class="tabbed-set tabbed-alternate" data-tabs=2:2><input checked=checked id=__tabbed_2_1 name=__tabbed_2 type=radio><input id=__tabbed_2_2 name=__tabbed_2 type=radio><div class=tabbed-labels><label for=__tabbed_2_1>query</label><label for=__tabbed_2_2>query template</label></div> <div class=tabbed-content> <div class=tabbed-block> <p><div class=highlight><pre><span></span><code><span class=nx>sum</span><span class=p>(</span><span class=nx>last_over_time</span><span class=p>(</span><span class=nx>istio_requests_total</span><span class=p>{</span>
<span class=w>  </span><span class=nx>destination_app</span><span class=p>=</span><span class=s>&quot;httpbin&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nx>namespace</span><span class=p>=</span><span class=s>&quot;default&quot;</span><span class=w>      </span>
<span class=p>}[</span><span class=mi>3600</span><span class=nx>s</span><span class=p>]))</span>
</code></pre></div> The metric is computed over the recent one-hour time window (that ends at the current time).</p> </div> <div class=tabbed-block> <p><div class=highlight><pre><span></span><code><span class=nx>sum</span><span class=p>(</span><span class=nx>last_over_time</span><span class=p>(</span><span class=nx>istio_requests_total</span><span class=p>{</span>
<span class=w>  </span><span class=nx>destination_app</span><span class=p>=</span><span class=s>&quot;httpbin&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nx>namespace</span><span class=p>=</span><span class=s>&quot;default&quot;</span><span class=w>      </span>
<span class=p>}[{{</span><span class=w> </span><span class=p>.</span><span class=nx>elapsedTimeSeconds</span><span class=w> </span><span class=p>}}</span><span class=nx>s</span><span class=p>]))</span>
</code></pre></div> The metric is computed over a recent time window (that ends at the current time). The length of this window is determined by the value of the template variable <code>elapsedTimeSeconds</code>.</p> </div> </div> </div> <p>Iter8 computes the value of the <code>elapsedTimeSeconds</code> variable dynamically in this task. This is the desirable behavior in multi-loop experiments (see <a href=#usage-example>usage example</a>), where metrics need to be fetched periodically, and the time window over which metrics are computed stretches farther back with each loop. The following sequence diagram illustrates how <code>elapsedTimeSeconds</code> changes over loops.</p> <pre class=mermaid><code>sequenceDiagram
    startingTime-)loop1: elapsedTimeSeconds=60;
    startingTime-)loop2: elapsedTimeSeconds=120;
    startingTime-)loop3: elapsedTimeSeconds=180;</code></pre> <hr> <p>Iter8 computes <code>elapsedTimeSeconds</code> based on another variable named <code>startingTime</code>. The default value of <code>startingTime</code> is the time at which the experiment is launched. The user can override the default by explicitly configuring <code>startingTime</code> during experiment launch, in the <a href=https://www.rfc-editor.org/rfc/rfc3339>RFC 3339</a> format (for example, <code>2020-02-01T09:44:40Z</code> or <code>2020-02-01T09:44:40.954641934Z</code>). Iter8 sets <code>elapsedTimeSeconds</code> as the difference (in seconds) between the current time and <code>startingTime</code>. This logic is illustrated in the following flowchart.</p> <pre class=mermaid><code>graph TD
  A([Start]) --&gt; B{startingTime parameter supplied?};
  B ----&gt;|Yes| C([elapsedTimeSeconds = currentTime - startingTime]);
  B ----&gt;|No| D([startingTime = time when experiment was launched]);
  D --&gt; C;
  C --&gt; E([End]);</code></pre> <p>Note that the above design enables the user to supply different <code>startingTime</code> values for different app versions (for instance, based on the creation timestamps of the versions).</p> <div class="tabbed-set tabbed-alternate" data-tabs=3:2><input checked=checked id=__tabbed_3_1 name=__tabbed_3 type=radio><input id=__tabbed_3_2 name=__tabbed_3 type=radio><div class=tabbed-labels><label for=__tabbed_3_1>Single <code>startingTime</code> value</label><label for=__tabbed_3_2>Two versions with different <code>startingTime</code> values</label></div> <div class=tabbed-content> <div class=tabbed-block> <div class=highlight><pre><span></span><code>--set<span class=w> </span>custommetrics.values.startingTime<span class=o>=</span><span class=s2>&quot;2020-02-01T09:44:40Z&quot;</span>
</code></pre></div> </div> <div class=tabbed-block> <div class=highlight><pre><span></span><code>--set<span class=w> </span>custommetrics.versionValues<span class=o>[</span><span class=m>0</span><span class=o>]</span>.startingTime<span class=o>=</span><span class=s2>&quot;2020-02-01T09:44:40Z&quot;</span><span class=w> </span><span class=se>\</span>
--set<span class=w> </span>custommetrics.versionValues<span class=o>[</span><span class=m>1</span><span class=o>]</span>.startingTime<span class=o>=</span><span class=s2>&quot;2020-02-05T14:22:15Z&quot;</span>
</code></pre></div> </div> </div> </div> </div> </div> </div> <h3 id=processing-response>Processing response<a class=headerlink href=#processing-response title="Permanent link">&para;</a></h3> <p>The metrics provider is expected to respond to Iter8's HTTP request for a metric with a JSON object. The format of this JSON object is provider-specific. Iter8 uses <a href=https://stedolan.github.io/jq/ >jq</a> to extract the metric value from the JSON response of the provider. The <code>jqExpression</code> used by Iter8 is supplied as part of the metric definition. When the <code>jqExpression</code> is applied to the JSON response, it is expected to yield a number.</p> <div class="tabbed-set tabbed-alternate" data-tabs=4:2><input checked=checked id=__tabbed_4_1 name=__tabbed_4 type=radio><input id=__tabbed_4_2 name=__tabbed_4 type=radio><div class=tabbed-labels><label for=__tabbed_4_1>Prometheus response example</label><label for=__tabbed_4_2>Prometheus jqExpression example</label></div> <div class=tabbed-content> <div class=tabbed-block> <p>The format of the Prometheus JSON response is <a href=https://prometheus.io/docs/prometheus/latest/querying/api/#format-overview>defined here</a>. A sample Prometheus response is as follows. <div class=highlight><table class=highlighttable><tr><td class=linenos><div class=linenodiv><pre><span></span><span class=normal> 1</span>
<span class=normal> 2</span>
<span class=normal> 3</span>
<span class=normal> 4</span>
<span class=normal> 5</span>
<span class=normal> 6</span>
<span class=normal> 7</span>
<span class=normal> 8</span>
<span class=normal> 9</span>
<span class=normal>10</span>
<span class=normal>11</span></pre></div></td><td class=code><div><pre><span></span><code><span class=p>{</span>
<span class=w>  </span><span class=nt>&quot;status&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;success&quot;</span><span class=p>,</span>
<span class=w>  </span><span class=nt>&quot;data&quot;</span><span class=p>:</span><span class=w> </span><span class=p>{</span>
<span class=w>    </span><span class=nt>&quot;resultType&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;vector&quot;</span><span class=p>,</span>
<span class=w>    </span><span class=nt>&quot;result&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
<span class=w>      </span><span class=p>{</span>
<span class=w>        </span><span class=nt>&quot;value&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=mf>1556823494.744</span><span class=p>,</span><span class=w> </span><span class=s2>&quot;21.7639&quot;</span><span class=p>]</span>
<span class=w>      </span><span class=p>}</span>
<span class=w>    </span><span class=p>]</span>
<span class=w>  </span><span class=p>}</span>
<span class=p>}</span><span class=w>    </span>
</code></pre></div></td></tr></table></div></p> </div> <div class=tabbed-block> <p>Consider the <code>jqExpression</code> defined in the <a href=#metrics-withwithout-auth>sample Prometheus metric</a>. Let us apply it to the <a href=#json-response>sample JSON response from Prometheus</a>. <div class=highlight><pre><span></span><code><span class=nb>echo</span><span class=w> </span><span class=s1>&#39;{</span>
<span class=s1>  &quot;status&quot;: &quot;success&quot;,</span>
<span class=s1>  &quot;data&quot;: {</span>
<span class=s1>    &quot;resultType&quot;: &quot;vector&quot;,</span>
<span class=s1>    &quot;result&quot;: [</span>
<span class=s1>      {</span>
<span class=s1>        &quot;value&quot;: [1556823494.744, &quot;21.7639&quot;]</span>
<span class=s1>      }</span>
<span class=s1>    ]</span>
<span class=s1>  }</span>
<span class=s1>}&#39;</span><span class=w> </span><span class=p>|</span><span class=w> </span>jq<span class=w> </span><span class=s2>&quot;.data.result[0].value[1] | tonumber&quot;</span>
</code></pre></div> Executing the above command results yields <code>21.7639</code>, a number, as required by Iter8. </p> <blockquote> <p><strong>Note:</strong> The shell command above is for illustration only. Iter8 uses Python bindings for <code>jq</code> to evaluate the <code>jqExpression</code>.</p> </blockquote> </div> </div> </div> <h2 id=defining-and-using-providers>Defining and using providers<a class=headerlink href=#defining-and-using-providers title="Permanent link">&para;</a></h2> <ol> <li>Understand how the <code>custommetrics</code> task works; this is described in <a href=#how-it-works>this section</a>.</li> <li>Create your provider template and serve it from a URL. A sample provider template is in <a href=#provider-template>this section</a>.</li> <li>Configure the <code>custommetrics</code> task with one or more provider templates. An example of <code>custommetrics</code> configuration is in <a href=#usage-example>this section</a>.</li> <li>The metrics fetched by this task can be used to assess app versions in Iter8 experiments. An example that illustrates the use of both <code>custommetrics</code> and <code>assess</code> tasks together is in <a href=#usage-example>this section</a>.</li> </ol> </article> </div> </div> <a href=# class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </a> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../assess/ class="md-footer__link md-footer__link--prev" aria-label="Previous: assess" rel=prev> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </div> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Previous </span> assess </div> </div> </a> <a href=../github/ class="md-footer__link md-footer__link--next" aria-label="Next: github" rel=next> <div class=md-footer__title> <div class=md-ellipsis> <span class=md-footer__direction> Next </span> github </div> </div> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Iter8 is open-source and available under the Apache 2 License. </div> </div> <div class=md-social> <a href=https://github.com/iter8-tools/iter8 target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://join.slack.com/t/iter8-tools/shared_invite/zt-awl2se8i-L0pZCpuHntpPejxzLicbmw target=_blank rel=noopener title=join.slack.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M94.12 315.1c0 25.9-21.16 47.06-47.06 47.06S0 341 0 315.1c0-25.9 21.16-47.06 47.06-47.06h47.06v47.06zm23.72 0c0-25.9 21.16-47.06 47.06-47.06s47.06 21.16 47.06 47.06v117.84c0 25.9-21.16 47.06-47.06 47.06s-47.06-21.16-47.06-47.06V315.1zm47.06-188.98c-25.9 0-47.06-21.16-47.06-47.06S139 32 164.9 32s47.06 21.16 47.06 47.06v47.06H164.9zm0 23.72c25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06H47.06C21.16 243.96 0 222.8 0 196.9s21.16-47.06 47.06-47.06H164.9zm188.98 47.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06s-21.16 47.06-47.06 47.06h-47.06V196.9zm-23.72 0c0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06V79.06c0-25.9 21.16-47.06 47.06-47.06 25.9 0 47.06 21.16 47.06 47.06V196.9zM283.1 385.88c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06-25.9 0-47.06-21.16-47.06-47.06v-47.06h47.06zm0-23.72c-25.9 0-47.06-21.16-47.06-47.06 0-25.9 21.16-47.06 47.06-47.06h117.84c25.9 0 47.06 21.16 47.06 47.06 0 25.9-21.16 47.06-47.06 47.06H283.1z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../../..", "features": ["navigation.instant", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.indexes"], "search": "../../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../../assets/javascripts/bundle.5a2dcb6a.min.js></script> </body> </html>